<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Calculator Comision - Praguri și Vizualizare</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h2 { color: #4CAF50; }
    input, select { margin: 5px; padding: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    th { background: #4CAF50; color: white; }
    .section { background: #fff; padding: 15px; border-radius: 5px; margin-bottom: 20px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    .btn-sterge { background: #e74c3c; color: white; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
    .info-section { margin-top: 30px; font-size: 14px; line-height: 1.5; background: #fff; padding: 10px; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h2>Calculator Comision - ver. 25</h2>

  <div class="section">
    <input type="text" id="nume" placeholder="Nume client" />
    <select id="banca">
      <option value="BCR">BCR</option>
    </select>
    <select id="tip">
      <option value="IP">IP</option>
    </select>
    <input type="number" id="suma" placeholder="Suma" />
    <select id="sursa">
      <option value="Recomandari">Recomandari</option>
      <option value="TeoCredit">TeoCredit</option>
      <option value="Agent Imobiliar">Agent Imobiliar</option>
    </select>
    <button onclick="adaugaInregistrare()">Adaugă</button>
    <button onclick="calculeazaToate()">Calculează</button>
  </div>

  <div id="tabelRezultate"></div>
  <div class="info-section" id="explicatii"></div>

  <script>
    const praguri = {
      BCR: [
        { prag: 0, procent: 0.8 },
        { prag: 800000, procent: 0.9 },
        { prag: 1600000, procent: 1.0 }
      ]
    };

    let inregistrari = [];

    function adaugaInregistrare() {
      const nume = document.getElementById("nume").value || "N/A";
      const banca = document.getElementById("banca").value;
      const tip = document.getElementById("tip").value;
      const suma = parseFloat(document.getElementById("suma").value);
      const sursa = document.getElementById("sursa").value;
      const categorie = sursa === "TeoCredit" ? 2 : (sursa.includes("Agent") ? 3 : 1);
      inregistrari.push({ nume, banca, tip, suma, sursa, categorie });
      calculeazaToate();
    }

    function stergeInregistrare(index) {
      inregistrari.splice(index, 1);
      calculeazaToate();
    }

    function calculeazaToate() {
      const totaluri = {};
      inregistrari.forEach(r => {
        if (!totaluri[r.banca]) {
          totaluri[r.banca] = { totalGeneral: 0, totalCat2: 0 };
        }
        totaluri[r.banca].totalGeneral += r.suma;
        if (r.categorie === 2) totaluri[r.banca].totalCat2 += r.suma;
      });

      const procenteMax = {};
      for (let banca in totaluri) {
        const total = totaluri[banca].totalGeneral;
        const prag = praguri[banca].filter(p => total >= p.prag).pop();
        procenteMax[banca] = prag ? prag.procent : 0;
      }

      let html = '<table><tr><th>Nr</th><th>Nume</th><th>Banca</th><th>Tip</th><th>Suma</th><th>Sursa</th><th>Procent</th><th>Comision</th><th>Acțiune</th></tr>';
      let total = 0;

      inregistrari.forEach((r, i) => {
        let procent = 0;
        if (r.categorie === 2) {
          procent = 0.4;
        } else if (r.categorie === 3) {
          procent = procenteMax[r.banca] / 2; // Corect: jumătate din pragul aplicat
        } else {
          procent = procenteMax[r.banca];
        }
        const comision = (r.suma * procent / 100);
        total += comision;
        html += `<tr><td>${i + 1}</td><td>${r.nume}</td><td>${r.banca}</td><td>${r.tip}</td><td>${r.suma}</td><td>${r.sursa}</td><td>${procent.toFixed(2)}%</td><td>${comision.toFixed(2)} RON</td><td><button class='btn-sterge' onclick='stergeInregistrare(${i})'>Șterge</button></td></tr>`;
      });

      html += `<tr><td colspan="7"><strong>Total</strong></td><td><strong>${total.toFixed(2)} RON</strong></td><td></td></tr></table>`;
      document.getElementById("tabelRezultate").innerHTML = html;

      let explicatii = "";
      for (let banca in totaluri) {
        const total = totaluri[banca].totalGeneral;
        const prag = praguri[banca].filter(p => total >= p.prag).pop();
        explicatii += `<p><strong>${banca}</strong>: Total introdus = ${total.toLocaleString()} RON → Prag aplicat = ${prag.procent.toFixed(2)}%</p>`;
      }
      document.getElementById("explicatii").innerHTML = explicatii;
    }
  </script>
</body>
</html>
