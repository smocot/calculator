<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="utf-8">
<title>Calculator Comision</title>

<!-- 1️⃣  SheetJS  -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
<!-- 2️⃣  jsPDF (PDF rămâne neschimbat) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
 body{font-family:sans-serif;background:#f5f7f9;padding:24px}
 h1{margin:0 0 14px;color:#2e7d32}
 table{width:100%;border-collapse:collapse;margin-top:14px;background:#fff}
 th,td{border:1px solid #ccc;padding:6px;font-size:.9rem}
 th{background:#4caf50;color:#fff}
 .right{text-align:right}
 button{padding:6px 10px;margin:2px;border:0;border-radius:3px;cursor:pointer}
 .green{background:#2e7d32;color:#fff}.yellow{background:#ffc107}.red{background:#e53935;color:#fff}
</style>
</head>
<body>

<h1>Calculator Comision</h1>

<input id="nume" placeholder="Nume client">
<input id="suma" placeholder="Suma">
<button class="green" onclick="addRow()">Adaugă</button>
<button class="yellow" onclick="calc()">Calculează</button>
<button class="green" onclick="exportXLSX()">Exportă XLSX</button>

<table id="tbl">
 <thead><tr><th>#</th><th>Nume</th><th>Suma</th><th>Comision</th><th></th></tr></thead>
 <tbody></tbody>
 <tfoot><tr><td colspan="3" class="right"><strong>Total castig</strong></td><td id="tot"></td><td></td></tr></tfoot>
</table>

<script>
const rows=[];
const $=id=>document.getElementById(id);
function addRow(){
  const n=$('nume').value||'N/A', s=parseFloat($('suma').value);
  if(!s){alert('Sumă!');return;}
  rows.push({nume:n,suma:s,pr:.01,com:s*.01});
  $('nume').value='';$('suma').value='';
  render();calc();
}
function del(i){rows.splice(i,1);render();calc();}
function render(){
  const tb=$('tbl').tBodies[0];tb.innerHTML='';
  rows.forEach((r,i)=>{
    tb.insertAdjacentHTML('beforeend',`<tr>
       <td>${i+1}</td><td>${r.nume}</td><td class=right>${r.suma}</td>
       <td class=right>${r.com.toFixed(2)}</td>
       <td><button class="red" onclick="del(${i})">x</button></td></tr>`);
  });
}
function calc(){
  const sum=rows.reduce((a,b)=>a+b.com,0);
  $('tot').textContent=sum.toFixed(2);
}

/* ---------- Export XLSX --------- */
function exportXLSX(){
  if(typeof XLSX==='undefined'){alert('SheetJS nu s-a încărcat!');return;}
  if(!rows.length){alert('Nu există date!');return;}

  const ws=XLSX.utils.json_to_sheet(rows);
  const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'Date');
  const ab=XLSX.write(wb,{bookType:'xlsx',type:'array'});

  const blob=new Blob([ab],{type:
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download='borderou.xlsx';
  document.body.appendChild(a);a.click();
  setTimeout(()=>{URL.revokeObjectURL(url);document.body.removeChild(a);},0);
}
</script>
</body>
</html>
