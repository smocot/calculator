<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Calculator Comision - ver. 29</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; }
    h1 { color: green; }
    input, select, button { margin: 0.25rem; padding: 0.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
    th { background-color: #4CAF50; color: white; }
    .delete { background-color: red; color: white; border: none; padding: 0.3rem 0.5rem; cursor: pointer; }
  </style>
</head>
<body>
<h1>Calculator Comision - ver. 29</h1>

<input id="numeClient" placeholder="Nume client">
<select id="banca">
  <option>BCR</option>
  <option>BRD</option>
  <option>ING</option>
  <option>UNICREDIT</option>
  <option>GARANTI</option>
  <option>FIRST BANK</option>
  <option>ALPHA</option>
  <option>RAIFFEISEN</option>
</select>
<select id="tip">
  <option>IP</option>
  <option>REF IP</option>
</select>
<input id="suma" placeholder="Suma">
<select id="sursa">
  <option>Recomandari</option>
  <option>TeoCredit</option>
  <option>Agent Imobiliar</option>
</select>
<button onclick="adaugaCredit()">Adaugă credit</button>
<button onclick="calculeaza()">Calculează</button>

<table>
  <thead>
    <tr><th>Nr</th><th>Nume</th><th>Banca</th><th>Tip</th><th>Suma</th><th>Sursa</th><th>Procent</th><th>Comision</th><th>Acțiune</th></tr>
  </thead>
  <tbody id="tabel"></tbody>
  <tfoot><tr><td colspan="7">Total</td><td id="total">0</td><td></td></tr></tfoot>
</table>
<p id="rezumat"></p>

<script>
const praguri = {
  "BCR": [
    { min: 0, max: 800000, percent: 0.008 },
    { min: 800001, max: 1600000, percent: 0.009 },
    { min: 1600001, max: 2400000, percent: 0.010 },
    { min: 2400001, max: 5000000, percent: 0.012 },
    { min: 5000001, max: 50000000, percent: 0.014 }
  ]
};

const inregistrari = [];

function adaugaCredit() {
  const nume = document.getElementById('numeClient').value || 'N/A';
  const banca = document.getElementById('banca').value;
  const tip = document.getElementById('tip').value;
  const suma = parseFloat(document.getElementById('suma').value);
  const sursa = document.getElementById('sursa').value;
  if (!suma || suma <= 0) return alert("Sumă invalidă");
  inregistrari.push({ nume, banca, tip, suma, sursa });
  document.getElementById('suma').value = "";
  afiseaza();
}

function afiseaza() {
  const tbody = document.getElementById('tabel');
  tbody.innerHTML = "";
  let total = 0;
  inregistrari.forEach((r, i) => {
    total += r.comision || 0;
    tbody.innerHTML += `<tr><td>${i+1}</td><td>${r.nume}</td><td>${r.banca}</td><td>${r.tip}</td><td>${r.suma.toLocaleString()}</td><td>${r.sursa}</td><td>${r.procent ? (r.procent * 100).toFixed(2) + '%' : ''}</td><td>${r.comision ? r.comision.toFixed(2).toLocaleString() + ' RON' : ''}</td><td><button class='delete' onclick='sterge(${i})'>Șterge</button></td></tr>`;
  });
  document.getElementById("total").innerText = total.toFixed(2).toLocaleString() + " RON";
}

function sterge(i) {
  inregistrari.splice(i, 1);
  afiseaza();
}

function calculeaza() {
  const totaluri = {};
  inregistrari.forEach(r => {
    if (!totaluri[r.banca]) totaluri[r.banca] = 0;
    if (r.sursa !== 'TeoCredit') totaluri[r.banca] += r.suma;
  });

  let rezumat = "";
  inregistrari.forEach(r => {
    const praguriBanca = praguri[r.banca] || [{min:0,max:Infinity,percent:0.008}];
    const total = totaluri[r.banca];
    const prag = [...praguriBanca].sort((a,b)=>b.min-a.min).find(p => total >= p.min) || { percent: 0.008 };

    if (r.sursa === "TeoCredit") r.procent = 0.004;
    else if (r.sursa === "Agent Imobiliar") r.procent = Math.round(prag.percent * 1000 * 0.8)/1000;
    else r.procent = prag.percent;

    r.comision = r.suma * r.procent;
  });

  afiseaza();
  const banca = inregistrari[0]?.banca;
  if (banca) {
    rezumat += `<strong>${banca}</strong>: Total introdus (Cat. 1 + 3) = ${totaluri[banca].toLocaleString()} RON → Prag aplicat = ${(inregistrari[0].procent * 100).toFixed(2)}%`;
  }
  document.getElementById("rezumat").innerHTML = rezumat;
}
</script>
</body>
</html>
