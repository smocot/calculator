<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Calculator Comision Agent</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f4f6f8;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      color: #2e7d32;
      margin-bottom: 1rem;
    }
    input, select, button {
      padding: 0.5rem;
      margin-right: 0.5rem;
      margin-bottom: 1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      margin-bottom: 2rem;
    }
    th, td {
      padding: 0.75rem;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #4caf50;
      color: white;
    }
    .delete {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
    }
    .summary {
      font-weight: bold;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
<h1>Calculator Comision - ver. 29</h1>

<input type="text" id="numeClient" placeholder="Nume client">
<select id="banca">
  <option>BCR</option>
  <option>BRD</option>
  <option>ING</option>
  <option>UNICREDIT</option>
  <option>GARANTI</option>
  <option>FIRST BANK</option>
  <option>ALPHA</option>
  <option>RAIFFEISEN</option>
</select>
<select id="tipCredit">
  <option>IP</option>
  <option>REF IP</option>
  <option>NEVOI</option>
  <option>REF NEVOI</option>
  <option>CONSTRUCTIE</option>
</select>
<input type="number" id="suma" placeholder="Suma">
<select id="sursa">
  <option>Recomandari</option>
  <option>TeoCredit</option>
  <option>Agent Imobiliar</option>
</select>
<input type="text" id="provider" placeholder="Provider (ex: BEE IMOBILIARE)">
<button onclick="adaugaInregistrare()">Adaugă credit</button>
<button onclick="calculeazaComisioane()">Calculează</button>
<input type="file" id="csvFile" accept=".csv">
<button onclick="importaCSV()">Încarcă CSV</button>

<table id="tabel">
  <thead>
  <tr>
    <th>Nr</th><th>Nume</th><th>Banca</th><th>Tip</th><th>Suma</th><th>Sursa</th><th>Procent</th><th>Comision</th><th>Acțiune</th>
  </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
  <tr><td colspan="7">Total</td><td id="totalComision"></td><td></td></tr>
  </tfoot>
</table>

<p id="rezumat" class="summary"></p>

<script>
  const praguri = {
    "BCR": [
      { min: 0, max: 800000, percent: 0.008 },
      { min: 800001, max: 1600000, percent: 0.009 },
      { min: 1600001, max: 2400000, percent: 0.010 },
      { min: 2400001, max: 5000000, percent: 0.012 },
      { min: 5000001, max: 50000000, percent: 0.014 }
    ],
    "BRD": [ { min: 0, max: Infinity, percent: 0.008 } ],
    "ING": [
      { min: 0, max: 1600000, percent: 0.008 },
      { min: 1600001, max: Infinity, percent: 0.009 }
    ],
    "UNICREDIT": [
      { min: 0, max: 800000, percent: 0.008 },
      { min: 800001, max: Infinity, percent: 0.009 }
    ],
    "GARANTI": [ { min: 0, max: Infinity, percent: 0.008 } ],
    "FIRST BANK": [ { min: 0, max: Infinity, percent: 0.008 } ],
    "ALPHA": [
      { min: 0, max: 800000, percent: 0.008 },
      { min: 800001, max: 1600000, percent: 0.009 },
      { min: 1600001, max: Infinity, percent: 0.010 }
    ],
    "RAIFFEISEN": [
      { min: 0, max: 800000, percent: 0.008 },
      { min: 800001, max: Infinity, percent: 0.009 }
    ]
  };

  const inregistrari = [];

  function adaugaInregistrare() {
    const nume = document.getElementById("numeClient").value || "N/A";
    const banca = document.getElementById("banca").value;
    const tip = document.getElementById("tipCredit").value;
    const suma = parseFloat(document.getElementById("suma").value);
    const sursa = document.getElementById("sursa").value;
    const provider = document.getElementById("provider").value || "";
    if (!suma || suma <= 0) return alert("Introduceți o sumă validă.");
    inregistrari.push({ nume, banca, tip, suma, sursa, provider });
    document.getElementById("suma").value = "";
    afiseazaInregistrari();
  }

  function importaCSV() {
    const file = document.getElementById("csvFile").files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      const lines = e.target.result.split('\n');
      lines.forEach(line => {
        const [nume, banca, tip, suma, sursa, provider] = line.split(',');
        if (!isNaN(parseFloat(suma))) {
          inregistrari.push({ nume: nume || "N/A", banca, tip, suma: parseFloat(suma), sursa, provider: provider || "" });
        }
      });
      afiseazaInregistrari();
    };
    reader.readAsText(file);
  }

  function afiseazaInregistrari() {
    const tbody = document.querySelector("#tabel tbody");
    tbody.innerHTML = "";
    inregistrari.forEach((r, i) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${i+1}</td><td>${r.nume}</td><td>${r.banca}</td><td>${r.tip}</td><td>${r.suma.toLocaleString()}</td>
        <td>${r.sursa}</td><td>${r.procent ? (r.procent * 100).toFixed(2) + "%" : ""}</td><td>${r.comision ? r.comision.toFixed(2).toLocaleString() + " RON" : ""}</td>
        <td><button class='delete' onclick='sterge(${i})'>Șterge</button></td>`;
      tbody.appendChild(row);
    });
  }

  function calculeazaComisioane() {
    const banci = [...new Set(inregistrari.map(r => r.banca))];
    let totalComision = 0;
    let rezumat = "";
    banci.forEach(banca => {
      const sumaCateg13 = inregistrari.filter(r => r.banca === banca && r.sursa !== "TeoCredit").reduce((a, b) => a + b.suma, 0);
      const prag = praguri[banca]?.find(p => sumaCateg13 >= p.min && sumaCateg13 <= p.max) || { percent: 0 };
      inregistrari.forEach(r => {
        if (r.banca === banca) {
          if (r.sursa === "TeoCredit") r.procent = 0.004;
          else if (r.sursa === "Agent Imobiliar") r.procent = prag.percent * 0.5;
          else r.procent = prag.percent;
          r.comision = r.suma * r.procent;
          totalComision += r.comision;
        }
      });
      rezumat += `<p><strong>${banca}</strong>: Total introdus (Cat. 1 + 3) = ${sumaCateg13.toLocaleString()} RON → Prag aplicat = ${(prag.percent * 100).toFixed(2)}%</p>`;
    });
    document.getElementById("totalComision").innerText = totalComision.toFixed(2).toLocaleString() + " RON";
    document.getElementById("rezumat").innerHTML = rezumat;
    afiseazaInregistrari();
  }

  function sterge(index) {
    inregistrari.splice(index, 1);
    afiseazaInregistrari();
  }
</script>
</body>
</html>
